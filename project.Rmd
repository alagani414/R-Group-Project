---
title: "Volleyball and Beach Volleyball Analysis"
output: html_document
---

```{r}
install.packages("leaflet")
install.packages("dplyr")
install.packages("htmltools")
install.packages("RColorBrewer")
install.packages("rworldmap")
install.packages("tidyverse")
install.packages("showtext")
install.packages("ggtext")
install.packages("waffle")
install.packages("MetBrewer")

```
# Volleyball Analysis

This report provides an analysis of Volleyball and Beach Volleyball performance metrics.

## Data Extraction {.tabset}

### Cleaning and Merging Data

```{r}
library(tidyverse)


# Load datasets
beach_volleyball <- read_csv("Beach Volleyball.csv")
volleyball <- read_csv("Volleyball.csv")
teams <- read_csv("teams.csv")
athletes <- read_csv("athletes.csv")

# Cleaning datasets
beach_volleyball_clean <- beach_volleyball %>%
  select(date, event_code, gender, event_stage, stage, discipline_code, participant_code, 
         participant_name, participant_country_code, result, result_WLT, start_order)

volleyball_clean <- volleyball %>%
  select(date, event_code, event_stage, gender, discipline_code, participant_code, 
         participant_name, participant_country_code, result, result_WLT, start_order)

athletes_clean <- athletes %>%
  rename(function_role = 'function') |> 
  mutate(code = as.character(code)) |>
  select(code, name, gender, function_role, country_code, nationality_code, height, weight, 
         disciplines, events, birth_date, birth_country, coach, hero, influence, 
         reason, sporting_relatives, other_sports)

# Expanding teams and joining with athletes
teams_expanded <- teams %>%
  mutate(athletes_codes = gsub("\\[|\\]|'", "", athletes_codes)) |> 
  separate_rows(athletes_codes, sep = ", ") %>%
  rename(athlete_code = athletes_codes) %>%
  left_join(athletes_clean, by = c("athlete_code" = "code")) %>%
  select(code, team, team_gender, country, athlete_code, name)

# Merging datasets
volleyball_with_athletes <- volleyball_clean %>%
  left_join(teams_expanded, by = c("participant_code" = "code"))

beach_volleyball_athletes <- beach_volleyball_clean %>%
  left_join(teams_expanded, by = c("participant_code" = "code"))

combined_volleyball <- bind_rows(
  mutate(beach_volleyball_athletes, dataset = "Beach Volleyball"),
  mutate(volleyball_with_athletes, dataset = "Volleyball")
)

final_combined <- combined_volleyball %>%
  left_join(athletes_clean, by = c("athlete_code" = "code")) %>%
  select(
    date, event_code, gender.x, event_stage, stage, discipline_code, participant_code,
    participant_name, participant_country_code, result, result_WLT, start_order,
    team, team_gender, country, athlete_code, name.x, dataset, 
    function_role, country_code, nationality_code, height, weight, disciplines, birth_date, 
    birth_country, coach, hero, influence, reason, sporting_relatives, other_sports
  )

```

```{r}
# Plot comparing wins by countries for Volleyball and Beach Volleyball
ggplot(comparison_long, aes(x = reorder(Country, Wins), y = Wins, fill = Discipline)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  facet_wrap(~ Discipline, scales = "free_y") +
  labs(title = "Top Performing Countries in Volleyball and Beach Volleyball",
       x = "Country",
       y = "Total Wins") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
# Plot combined Male vs Female performance
ggplot(combined_gender_performance, aes(x = gender.x, y = total_wins, fill = gender.x)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Male vs Female Performance",
       x = "Gender",
       y = "Total Wins") +
  facet_wrap(~ sport) +
  theme_minimal() +
  scale_fill_manual(values = c("Male" = "blue", "Female" = "pink"))
```

```{r}  
# Plot wins based on height category for Volleyball
ggplot(height_wins, aes(x = height_category, y = total_wins, fill = height_category)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Wins Based on Height in Volleyball",
       x = "Height Category",
       y = "Total Wins") +
  theme_minimal() +
  scale_fill_manual(values = c("Short (<180 cm)" = "blue",
                               "Medium (180-200 cm)" = "green",
                               "Tall (>200 cm)" = "orange"))

```

```{r}
# Plot wins based on age for Volleyball (Male vs Female)
ggplot(age_gender_wins, aes(x = age, y = total_wins, color = gender.x)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  labs(
    title = "Wins Based on Age for Volleyball (Male vs Female)",
    x = "Age (in years)",
    y = "Total Wins",
    color = "Gender"
  ) +
  theme_minimal() +
  scale_color_manual(values = c("Male" = "blue", "Female" = "pink"))

```

```{r}
# Plot influence of start order on results for Volleyball and Beach Volleyball
ggplot(combined_data_summary, aes(x = result_WLT, y = count, fill = as.factor(start_order))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Influence of Start Order on Result (Volleyball vs Beach Volleyball)",
       x = "Result (W/L/T)",
       y = "Count",
       fill = "Start Order") +
  facet_wrap(~ sport) +
  theme_minimal()

```


```{r}
# Load required libraries
library(leaflet)
library(dplyr)
library(htmltools)
library(rworldmap)

# Summarize wins by country for Volleyball
vb_wins <- data %>%
  filter(dataset == "Volleyball") %>%
  group_by(country) %>%
  summarise(Volleyball_Wins = sum(result_WLT == "W", na.rm = TRUE)) %>%
  arrange(desc(Volleyball_Wins)) %>%
  slice(1:4)  # Select top 4 countries

# Summarize wins by country for Beach Volleyball
beach_vb_wins <- data %>%
  filter(dataset == "Beach Volleyball") %>%
  group_by(country) %>%
  summarise(Beach_Volleyball_Wins = sum(result_WLT == "W", na.rm = TRUE)) %>%
  arrange(desc(Beach_Volleyball_Wins)) %>%
  slice(1:4)  # Select top 4 countries

# Combine data for both disciplines
top_countries <- vb_wins %>%
  full_join(beach_vb_wins, by = "country") %>%
  mutate(Total_Wins = coalesce(Volleyball_Wins, 0) + coalesce(Beach_Volleyball_Wins, 0))

# Load world geospatial data
world_map <- getMap(resolution = "low")

# Match country names with the geospatial data
world_map@data <- left_join(world_map@data, top_countries, by = c("ADMIN" = "country"))

# Define ranges and colors for Volleyball (9 colors)
vb_ranges <- c(0, 5, 10, 15, 20, 25, 30, 35, 40, 50)
vb_colors <- colorRampPalette(c("#e0f7fa", "#006064"))(9)  # Light to dark teal

# Define ranges and colors for Beach Volleyball (9 colors)
beach_vb_ranges <- c(0, 5, 10, 15, 20, 25, 30, 35, 40, 50)
beach_vb_colors <- colorRampPalette(c("#fff3e0", "#e65100"))(9)  # Light to dark orange

# Create palettes for both sports
vb_palette <- colorBin(palette = vb_colors, bins = vb_ranges, domain = world_map@data$Volleyball_Wins, na.color = "#ffffff")
beach_vb_palette <- colorBin(palette = beach_vb_colors, bins = beach_vb_ranges, domain = world_map@data$Beach_Volleyball_Wins, na.color = "#ffffff")

# Generate leaflet map
leaflet(world_map) %>%
  addPolygons(
    fillColor = ~vb_palette(Volleyball_Wins),
    weight = 0,  # Remove outlines
    fillOpacity = 0.85,
    label = ~htmlEscape(paste(NAME, "<br>Volleyball Wins:", Volleyball_Wins)),
    group = "Volleyball",
    highlightOptions = highlightOptions(
      fillOpacity = 1,
      bringToFront = TRUE
    )
  ) %>%
  addPolygons(
    fillColor = ~beach_vb_palette(Beach_Volleyball_Wins),
    weight = 0,  # Remove outlines
    fillOpacity = 0.85,
    label = ~htmlEscape(paste(NAME, "<br>Beach Volleyball Wins:", Beach_Volleyball_Wins)),
    group = "Beach Volleyball",
    highlightOptions = highlightOptions(
      fillOpacity = 1,
      bringToFront = TRUE
    )
  ) %>%
  addLayersControl(
    overlayGroups = c("Volleyball", "Beach Volleyball"),
    options = layersControlOptions(collapsed = FALSE)
  ) %>%
  addLegend(
    "bottomright",
    pal = vb_palette,
    values = ~Volleyball_Wins,
    title = "Volleyball Wins",
    opacity = 1,
    group = "Volleyball"
  ) %>%
  addLegend(
    "topright",
    pal = beach_vb_palette,
    values = ~Beach_Volleyball_Wins,
    title = "Beach Volleyball Wins",
    opacity = 1,
    group = "Beach Volleyball"
  ) %>%
  addTiles()  # Add default map tiles



```

```{r}



```


```{r}

```